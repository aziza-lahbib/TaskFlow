<div class="container" *ngIf="user; else loadingProfile">

  <div class="header">
    <h2>Bienvenue, {{ user.username }}</h2>
    <button class="logout-btn" (click)="logout()">DÃ©connexion</button>
  </div>

  <h2>Mes TÃ¢ches</h2>

  <div *ngIf="loadingTasks">Chargement des tÃ¢ches...</div>

  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <div *ngIf="!loadingTasks && tasks.length > 0; else noTasks">
    <div class="task-card" *ngFor="let task of tasks">
      <input
        type="checkbox"
        [checked]="task.completed"
        (change)="toggleTaskStatus(task)"
        [disabled]="task.validee === 1 || task.validee === 0"
        aria-label="Statut de la tÃ¢che"
      />

      <ng-container *ngIf="editingTaskId === task.id; else displayMode">
        <div class="task-details">
          <input [(ngModel)]="editedTitle" placeholder="Titre" required />
          <input [(ngModel)]="editedDescription" placeholder="Description" required />
          <span [style.color]="task.completed ? 'green' : 'orange'">
            {{ task.completed ? 'âœ”ï¸ TerminÃ©e' : 'â³ En cours' }}
          </span>

          <span *ngIf="task.validee === 1" class="validated-indicator">
            âœ”ï¸ ValidÃ©e par admin
          </span>
          <span *ngIf="task.validee === 0" class="refused-indicator">
            âŒ RefusÃ©e par admin
          </span>
        </div>
        <div class="task-actions">
          <!-- Sauvegarder interdit si validÃ©e -->
          <button (click)="saveTask(task)" [disabled]="task.validee === 1">ğŸ’¾ Enregistrer</button>
          <button (click)="cancelEdit()">âŒ Annuler</button>
        </div>
      </ng-container>

      <ng-template #displayMode>
        <div class="task-details">
          <h4>{{ task.title }}</h4>
          <p>{{ task.description }}</p>
          <span [style.color]="task.completed ? 'green' : 'orange'">
            {{ task.completed ? 'âœ”ï¸ TerminÃ©e' : 'â³ En cours' }}
          </span>

          <span *ngIf="task.validee === 1" class="validated-indicator">
            âœ”ï¸ ValidÃ©e par admin
          </span>
          <span *ngIf="task.validee === 0" class="refused-indicator">
            âŒ RefusÃ©e par admin
          </span>
        </div>
        <div class="task-actions">
          <!-- Autorise Ã©dition uniquement si NON validÃ©e -->
          <button *ngIf="task.validee !== 1" (click)="editTask(task)">âœï¸</button>
          <!-- Suppression toujours possible -->
          <button (click)="deleteTask(task.id)">ğŸ—‘ï¸</button>
        </div>
      </ng-template>
    </div>
  </div>

  <ng-template #noTasks>
      <p>Commencez votre premiÃ¨re tÃ¢che pour bien dÃ©marrer !</p>
    
  </ng-template>

  <h3>â• Ajouter une nouvelle tÃ¢che</h3>

  <form (ngSubmit)="addTask()" #taskForm="ngForm">
    <input type="text" name="title" [(ngModel)]="newTaskTitle" placeholder="Titre" required />
    <input type="text" name="description" [(ngModel)]="newTaskDescription" placeholder="Description" required />
    <button type="submit" [disabled]="!taskForm.form.valid">Ajouter</button>
  </form>

</div>

<ng-template #loadingProfile>
  <p>Chargement du profil...</p>
</ng-template>
